<mujoco model="1dof_joint_realistic">
  <compiler angle="radian" autolimits="true" inertiafromgeom="true"/>
  <!-- 减小步长有助于高速碰撞时的稳定性 -->
  <option timestep="0.001" integrator="RK4" gravity="0 0 -9.81">
    <flag contact="enable" energy="enable"/>
  </option>

  <default>
    <!-- 
       【参数回调】
       damping: 0.5 -> 0.1 (恢复较为真实的低阻尼)
       frictionloss: 0.2 (保留干摩擦，这是真实的)
       armature: 0.05 (保留转子惯量，这对稳定性很重要)
    -->
    <joint damping="0.1" frictionloss="0.2" armature="0.05"/>
    <geom type="capsule" size="0.02" rgba="0.7 0.7 0.7 1"/>
  </default>

  <worldbody>
    <geom name="floor" type="plane" size="0 0 0.1" rgba="0.8 0.8 0.8 1"/>
    
    <!-- 基座 -->
    <body name="base_link" pos="0 0 0.5">
      <geom type="box" size="0.06 0.06 0.06" rgba="0.2 0.2 0.2 1" mass="5.0"/>
      <geom type="capsule" size="0.05" fromto="0 0 0 0.08 0 0" quat="0.707 0 0.707 0" rgba="0.3 0.3 0.3 1" mass="1.0"/>

      <!-- 理想输出轴 -->
      <body name="gearbox_output_shaft" pos="0.2 0 0" euler="0 1.5708 0">
        <!-- 
           【关键修复】limited="true"
           强制物理引擎在到达角度极限时施加硬约束
        -->
        <joint name="joint_ideal" type="hinge" axis="0 0 1" 
               range="-3.0 3.0" limited="true"/>
        
        <geom type="capsule" size="0.015" fromto="0 0 0 0 0 0.02" rgba="0.9 0.5 0.1 1" mass="0.1"/>

        <!-- 实际负载 -->
        <body name="actual_load" pos="0 0 0">
          <joint name="joint_backlash" type="hinge" axis="0 0 1" 
                 range="-0.01 0.01" limited="true" 
                 stiffness="0" damping="0.01" frictionloss="0" armature="0"/>
          
          <inertial pos="0.15 0 0" mass="0.5" diaginertia="0.005 0.005 0.005"/>
          <geom type="box" size="0.15 0.02 0.005" pos="0.15 0 0" rgba="0 0.5 0.8 1"/>
          <geom type="sphere" size="0.03" pos="0.3 0 0" rgba="1 0 0 1" mass="0.2"/>
        </body>
      </body>
    </body>
  </worldbody>

  <contact>
    <exclude body1="base_link" body2="actual_load"/>
  </contact>

  <actuator>
    <motor name="motor_driver" joint="joint_ideal" gear="6" ctrllimited="true" ctrlrange="-5 5"/>
  </actuator>
</mujoco>